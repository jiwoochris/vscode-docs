
# 1. 개요 및 목적

본 프로젝트는 익명의 참여자들이 특정 회식 이벤트에 대한 메뉴 후보를 제안하고, 투표하며, 그 결과를 확인할 수 있는 백엔드 API를 구현하는 것을 목표로 합니다. 이전 버전이 단일 회식에 대한 투표를 다루었다면, 본 버전에서는 여러 개의 독립적인 회식 메뉴 투표 이벤트를 생성하고 관리할 수 있도록 기능을 확장합니다. 이를 통해 다양한 시점의 회식 또는 여러 부서의 회식에 대한 투표를 유연하게 처리할 수 있습니다.

---

## 2. 핵심 엔티티 정의

기존 `MenuItem` 및 `Vote` 엔티티 외에, 회식 이벤트를 관리하는 새로운 `DinnerEvent` 엔티티를 추가합니다.

- **DinnerEvent (회식 이벤트)**
  - `event_id` (UUID, Primary Key): 각 회식 이벤트를 고유하게 식별하는 ID.
  - `name` (String, Required): 회식 이벤트의 이름 (예: "2025년 여름 본부 회식 메뉴 투표").
  - `description` (String, Optional): 회식 이벤트에 대한 상세 설명.
  - `start_time` (Datetime, Required): 투표가 시작되는 시간.
  - `end_time` (Datetime, Required): 투표가 마감되는 시간.
  - `created_at` (Datetime, Default: 현재 시각): 이벤트 생성 시각.
  - `updated_at` (Datetime, Default: 현재 시각, On Update: 현재 시각): 이벤트 정보 마지막 업데이트 시각.

- **MenuItem (메뉴 후보)**
  - `item_id` (UUID, Primary Key): 메뉴 후보를 고유하게 식별하는 ID.
  - `event_id` (UUID, Foreign Key to DinnerEvent.event_id): 이 메뉴 후보가 속한 회식 이벤트의 ID. (추가/변경)
  - `name` (String, Required): 메뉴 이름 (예: "마라탕", "삼겹살").
  - `description` (String, Optional): 메뉴에 대한 상세 설명.
  - `suggested_by` (String, Optional): 메뉴를 제안한 사람 (익명 참여).
  - `created_at` (Datetime, Default: 현재 시각): 메뉴 후보 생성 시각.
  - `updated_at` (Datetime, Default: 현재 시각, On Update: 현재 시각): 메뉴 후보 정보 마지막 업데이트 시각.

- **Vote (투표)**
  - `vote_id` (UUID, Primary Key): 투표를 고유하게 식별하는 ID.
  - `item_id` (UUID, Foreign Key to MenuItem.item_id): 투표된 메뉴 후보의 ID.
  - `event_id` (UUID, Foreign Key to DinnerEvent.event_id): 이 투표가 속한 회식 이벤트의 ID. (추가/변경)
  - `participant_id` (String, Required): 투표 참여자를 식별하는 임시 ID (클라이언트 측에서 생성/전달). 이는 단일 이벤트 내에서의 중복 투표 방지에 사용됩니다. *(이전 대화)*
  - `created_at` (Datetime, Default: 현재 시각): 투표 시각.

---

## 3. API 엔드포인트

기존 엔드포인트는 특정 `DinnerEvent`에 종속되도록 변경되며, `DinnerEvent` 자체를 관리하는 엔드포인트가 추가됩니다.

### 3.1. DinnerEvent 관리 (관리자 역할, 인증 없음)

- **POST /events**
    - 목적: 새로운 회식 이벤트를 생성합니다.
    - 요청 바디: `name`, `description`, `start_time`, `end_time`
    - 응답: 생성된 DinnerEvent 객체.
    - 비고: 인증 절차가 없으므로, 이 API는 사실상 누구나 호출 가능합니다. 실제 서비스에서는 관리자 인증이 필요합니다. *(이전 대화)*

- **GET /events**
    - 목적: 모든 회식 이벤트 목록을 조회합니다.
    - 응답: DinnerEvent 객체 목록.

- **GET /events/{event_id}**
    - 목적: 특정 event_id에 해당하는 회식 이벤트 정보를 조회합니다.
    - 경로 파라미터: `event_id` (UUID)
    - 응답: DinnerEvent 객체.
    - 오류: 해당 event_id가 존재하지 않을 경우 404 Not Found.

- **PUT /events/{event_id}**
    - 목적: 특정 event_id에 해당하는 회식 이벤트 정보를 업데이트합니다.
    - 경로 파라미터: `event_id` (UUID)
    - 요청 바디: `name`, `description`, `start_time`, `end_time` (모두 선택 사항, 부분 업데이트 가능)
    - 응답: 업데이트된 DinnerEvent 객체.
    - 오류: 해당 event_id가 존재하지 않을 경우 404 Not Found.

- **DELETE /events/{event_id}**
    - 목적: 특정 event_id에 해당하는 회식 이벤트를 삭제합니다 (연결된 메뉴 후보 및 투표도 함께 삭제).
    - 경로 파라미터: `event_id` (UUID)
    - 응답: 성공 시 204 No Content.
    - 오류: 해당 event_id가 존재하지 않을 경우 404 Not Found.

### 3.2. MenuItem 및 Vote 작업 (이벤트별)

모든 메뉴 후보 등록, 투표, 결과 조회는 이제 특정 event_id 하에 이루어집니다.

- **POST /events/{event_id}/menu_items**
    - 목적: 특정 회식 이벤트에 새로운 메뉴 후보를 등록합니다.
    - 경로 파라미터: `event_id` (UUID)
    - 요청 바디: `name`, `description` (선택 사항), `suggested_by` (선택 사항)
    - 응답: 생성된 MenuItem 객체.
    - 오류: 해당 event_id가 존재하지 않을 경우 404 Not Found. 투표 기간이 아닐 경우 400 Bad Request.

- **GET /events/{event_id}/menu_items**
    - 목적: 특정 회식 이벤트의 모든 메뉴 후보를 조회합니다.
    - 경로 파라미터: `event_id` (UUID)
    - 응답: MenuItem 객체 목록.
    - 오류: 해당 event_id가 존재하지 않을 경우 404 Not Found.

- **POST /events/{event_id}/menu_items/{item_id}/vote**
    - 목적: 특정 회식 이벤트의 특정 메뉴 후보에 투표합니다.
    - 경로 파라미터: `event_id` (UUID), `item_id` (UUID)
    - 요청 헤더: `X-Participant-ID` (클라이언트 측에서 생성된 고유 ID)
    - 응답: 생성된 Vote 객체.
    - 오류: 해당 event_id 또는 item_id가 존재하지 않을 경우 404 Not Found. X-Participant-ID가 누락되거나 유효하지 않을 경우 400 Bad Request. 해당 participant_id가 이미 해당 event_id 내 item_id에 투표했을 경우 409 Conflict. 투표 기간이 아닐 경우 400 Bad Request.

- **GET /events/{event_id}/menu_items/results**
    - 목적: 특정 회식 이벤트의 메뉴별 투표 결과를 조회합니다 (투표 수 기준 내림차순 정렬).
    - 경로 파라미터: `event_id` (UUID)
    - 응답: 각 MenuItem에 대한 name, vote_count를 포함하는 객체 목록.
    - 오류: 해당 event_id가 존재하지 않을 경우 404 Not Found.

---

## 4. 기능적 제약 및 고려사항

- **인증 절차 없음**: 요청에 따라 로그인, 회원가입 등의 인증 절차는 포함되지 않습니다. `participant_id`는 클라이언트 측에서 생성/전달되는 임시 ID이며, 이는 단일 회식 이벤트 내에서의 중복 투표를 방지하는 데 주로 사용됩니다. 영구적인 사용자 식별이나 여러 회식 이벤트에 걸친 사용자 활동 추적은 불가능합니다.
- **간단한 관리**: DinnerEvent 생성 및 관리 API는 인증 없이 호출될 수 있습니다. 이는 실습의 단순화를 위함이며, 실제 운영 환경에서는 관리자 인증 및 권한 부여가 반드시 필요합니다.
- **기간 제약**: DinnerEvent의 `start_time`과 `end_time`을 기준으로 메뉴 후보 추가 및 투표 가능 여부를 제어합니다. 투표 기간이 아닌 경우 관련 API는 에러를 반환해야 합니다.

---

## 5. 개발 환경 및 기술 스택 (기존 유지)

- **백엔드**: Python with FastAPI
- **데이터베이스**: SQLite (개발용), PostgreSQL (배포용 고려)
- **종속성 관리**: uv
- **테스트**: Pytest
- **API 문서화**: Swagger UI (FastAPI 자동 생성)